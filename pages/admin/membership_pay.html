<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Subir comprobante – Volcanes</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Estilos (mínimos) -->
  <style>
    :root{
      --club-green:#19473f;
      --club-yellow:#e8ce26;
    }
    body{ background:#f6f7f8; }
    .card-soft{
      background:#fff;
      border-radius:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      border:1px solid rgba(0,0,0,.06);
    }
    .brand{
      font-weight:900;
      color:var(--club-green);
      letter-spacing:.4px;
    }
    .pill{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      font-weight:800;
      background:rgba(232,206,38,.25);
      color:var(--club-green);
      font-size:.85rem;
    }
    .helper{ color:rgba(0,0,0,.65); font-size:.92rem; }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    .disabled-overlay{
      position:relative;
      opacity:.55;
      pointer-events:none;
      filter:grayscale(0.3);
    }
  </style>
</head>

<body>
  <main class="container py-4" style="max-width: 820px;">
    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
      <div>
        <div class="brand fs-4">VOLCANES</div>
        <div class="helper">Subida de comprobante de membresía</div>
      </div>
      <span class="pill" id="pagePill">Cargando…</span>
    </div>

    <!-- Estado / errores -->
    <div id="alertBox" class="alert alert-warning d-none" role="alert"></div>

    <!-- Resumen -->
    <div class="card-soft p-3 mb-3">
      <div class="d-flex justify-content-between align-items-start gap-3 flex-wrap">
        <div>
          <div class="helper">Asociado</div>
          <div class="fw-bold fs-5" id="assocName">—</div>
          <div class="helper" id="assocContact">—</div>
        </div>

        <div class="text-end">
          <div class="helper">Plan</div>
          <div class="fw-bold" id="planName">—</div>
          <div class="helper" id="planMeta">—</div>
        </div>
      </div>
    </div>

    <!-- Card cuando el link está bloqueado -->
    <div id="payDisabledCard" class="card shadow-sm mb-3 d-none">
      <div class="card-body">
        <div class="fw-bold mb-1">Link no disponible</div>
        <div class="text-muted" id="payDisabledMsg">
          Este link está deshabilitado mientras el admin revisa el comprobante.
        </div>
      </div>
    </div>

    <!-- Form -->
    <div class="card-soft p-3">
      <h5 class="mb-2">Enviar comprobante</h5>
      <div class="helper mb-3">
        Subí una imagen (screenshot) o PDF. Un admin validará tu pago.
      </div>

      <form id="payForm" class="row g-3">
        <!-- ✅ NUEVO: cuotas multi-select -->
        <div class="col-12">
          <label class="form-label">¿Qué cuotas estás pagando?</label>
          <div id="installmentsBox" class="mt-1">
            <div class="text-muted">Cargando cuotas…</div>
          </div>
          <div class="helper mt-1" id="installmentsBoxHint">—</div>
        </div>

        <!-- (Fallback opcional) select viejo -->
        <div class="col-12 d-none">
          <label class="form-label">Fallback (1 cuota)</label>
          <select id="installmentSelect" class="form-select">
            <option value="">Pago general (sin cuota específica)</option>
          </select>
          <div class="helper mt-1" id="installmentHint">—</div>
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">Nombre</label>
          <input id="payerName" class="form-control" placeholder="Tu nombre" />
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">Monto</label>
          <input id="amount" type="number" class="form-control" placeholder="Ej: 20000" />
          <div class="helper mt-1" id="amountHint"></div>
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">Email (opcional)</label>
          <input id="email" class="form-control" placeholder="correo@ejemplo.com" />
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">Teléfono (opcional)</label>
          <input id="phone" class="form-control" placeholder="8888-8888" />
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">Método</label>
          <select id="method" class="form-select">
            <option value="sinpe">SINPE</option>
            <option value="transfer">Transferencia</option>
            <option value="cash">Efectivo</option>
            <option value="other">Otro</option>
          </select>
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label">Comprobante (imagen o PDF)</label>
          <input id="file" type="file" class="form-control" accept="image/*,application/pdf" />
          <div class="helper mt-1">Recomendado: screenshot claro donde se vea monto y fecha.</div>
        </div>

        <div class="col-12">
          <label class="form-label">Nota (opcional)</label>
          <textarea id="note" class="form-control" rows="2" placeholder="Ej: pago de 2 cuotas juntas, referencia, etc."></textarea>
        </div>

        <!-- Progress -->
        <div class="col-12">
          <div class="progress d-none" id="progressWrap" style="height: 10px;">
            <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%"></div>
          </div>
          <div class="helper mt-2 d-none" id="progressText">—</div>
        </div>

        <div class="col-12 d-flex gap-2 flex-wrap">
          <button class="btn btn-success" id="btnSubmit" type="submit">
            Enviar comprobante
          </button>
          <button class="btn btn-light" id="btnReset" type="button">
            Limpiar
          </button>
        </div>

        <div class="col-12">
          <div class="helper">
            ID: <span class="mono" id="midText">—</span>
          </div>
        </div>
      </form>
    </div>

    <div class="helper text-center mt-3">
      Si tenés dudas, contactá al club.
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="/js/features/membership_pay.js"></script>
</body>
</html>
